import { Service } from '..'
import { fetch } from 'fetch-h2'

export const service: Service = {
  supported: [
    '42',
    '2give',
    'adc',
    'agm',
    'alias',
    'arco',
    'arepa',
    'arg',
    'ari',
    'audax',
    'aur',
    'b3',
    'bay',
    'bbk',
    'bbp',
    'bbtc',
    'bcc',
    'bccx',
    'bct',
    'bean',
    'blc',
    'blitz',
    'blk',
    'block',
    'bnode',
    'boli',
    'bro',
    'bsd',
    'btc',
    'btc2',
    'btdx',
    'btx',
    'bwi',
    'bxt',
    'byc',
    'bynd',
    'bytz',
    'cann',
    'caps',
    'cbx',
    'cdn',
    'chbt',
    'chess',
    'circ',
    'civ',
    'cloak',
    'cno',
    'colx',
    'cps',
    'crt',
    'crypt',
    'crw',
    'cure',
    'dash',
    'dem',
    'dgb',
    'dgc',
    'dime',
    'divi',
    'dmd',
    'd',
    'dmb',
    'donu',
    'dope',
    'drz',
    'dvc',
    'eac',
    'ec',
    'ecc',
    'efl',
    'egc',
    'elt',
    'emc2',
    'emd',
    'enrg',
    'eny',
    'excl',
    'firo',
    'fst',
    'ftc',
    'gap',
    'gcr',
    'gio',
    'glc',
    'glt',
    'gpl2',
    'grn',
    'grs',
    'grs-test',
    'grwi',
    'gun',
    'hth',
    'html',
    'i0c',
    'ic',
    'icn',
    'icol',
    'ifc',
    'iflt',
    'il8p',
    'img',
    'imgc',
    'infx',
    'inn',
    'insn',
    'ioc',
    'ion',
    'ixc',
    'j',
    'ked',
    'kfx',
    'klks',
    'kobo',
    'konj',
    'kore',
    'lana',
    'lcc',
    'linx',
    'lit',
    'lkr',
    'ltc',
    'ltn',
    'lux',
    'lynx',
    'manna',
    'marks',
    'mec',
    'mnc',
    'moon',
    'mrc',
    'mue',
    'n8v',
    'nav',
    'netko',
    'neva',
    'nix',
    'nmc',
    'nobl',
    'nor',
    'nyc',
    'ocp',
    'ok',
    'onion',
    'ozc',
    'pak',
    'part',
    'pcn',
    'petal',
    'pho',
    'phr',
    'piggy',
    'pink',
    'pivx',
    'pnd',
    'pny',
    'pny-old',
    'pot',
    'ppc',
    'ppc-test',
    'ptc',
    'put',
    'pwrb',
    'pyrk',
    'qrk',
    'ric',
    'roger',
    'scifi',
    'scol',
    'scribe',
    'sfd',
    'slg',
    'slm',
    'slr',
    'sls',
    'smly',
    'spd',
    'spk',
    'sprts',
    'sqr',
    'stk',
    'strat',
    'strax',
    'strax-test',
    'swing',
    'sxc',
    'sys',
    'taj',
    'talk-old',
    'tes',
    'toa',
    'trex',
    'trc',
    'troll',
    'trump',
    'ttn',
    'tzc',
    'ufo',
    'umo',
    'uno',
    'utip',
    'val',
    'vcn',
    'veil',
    'vls',
    'vgs',
    'vestx',
    'via',
    'vrc',
    'vrm',
    'vtc',
    'wdc',
    'wex',
    'wgr',
    'x0z',
    'xbc',
    'xc',
    'xcz',
    'xjo',
    'xmg',
    'xmy',
    'xp',
    'xpm',
    'xst',
    'trust',
    'xvp',
    'zeit',
    'zet',
    'zln',
    'znz'
  ].map((x) => x.toUpperCase()),

  check(addr) {
    return RegExp('^[SMD][a-km-zA-HJ-NP-Z0-9]{26,33}$').test(addr)
  },

  async fetch({ addr, coin, verbose }) {
    const url = `https://chainz.cryptoid.info/${coin.toLowerCase()}/api.dws?q=getbalance&a=${addr}`

    if (verbose) console.log(`Requesting ${url}`)

    const res = await fetch(url)

    if (res.status < 200 || res.status >= 300) throw new Error(JSON.stringify(res))

    const json = await res.json()

    return {
      balance: parseFloat(json),
      asset: coin
    }
  }
}
